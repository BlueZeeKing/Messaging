"use strict";var name,addNewLetterGUI=document.getElementById("newLetter"),msgStatus=document.getElementById("msgStatus"),body=document.getElementById("body"),readBody=document.getElementById("bodyR"),lettersObj=document.getElementById("letters"),backdrop=document.getElementById("backdrop"),currentStatus=0,letters=[],open=!1,changeEvent=new Event("change");function formatName(e){return e.trim().toLowerCase()}function unformatName(e){for(var t=e.split(" "),n=0;n<t.length;n++)t[n]=t[n][0].toUpperCase()+t[n].substring(1,t[n].length);return t.join(" ")}function clicked(e){i=e.srcElement.id.slice(1);var t=letters[i];open=t.id,document.getElementById("from").innerHTML=letters[i].display;for(var n="",r=0;r<t.body.length;r++){var s=t.body[r].split("|");n=s[0]==name?n+"<div class='text-right text-xs text-gray-600'>"+unformatName(s[0])+"</div><div class='text-right'>"+s[1]+"</div>":n+"<div class='text-left text-xs text-gray-600'>"+unformatName(s[0])+"</div><div class='text-left'>"+s[1]+"</div>"}readBody.innerHTML=n,openReadLetter(),t.read="",letters[i]=t,e.srcElement.innerHTML=t.display+t.read}function display(){var e="";if(letters.length<=0)e="<p>No letters</p>";else{for(var t=0;t<letters.length-1;t++)e=e+"<p class = 'font-bold p-1' id=\"i"+t.toString()+'">'+letters[t].display+" "+letters[t].read+"</p><hr class='mx-2 border-2 border-green-400'>";e=e+"<p class = 'font-bold p-1' id=\"i"+(letters.length-1).toString()+'">'+letters[letters.length-1].display+letters[letters.length-1].read+"</p>"}document.getElementById("letters").innerHTML=e;for(var n=0;n<letters.length;n++)document.getElementById("i"+n.toString()).addEventListener("click",clicked)}function closeReadLetter(){backdrop.style.opacity="0",setTimeout((function(){document.getElementById("readLetter").style.transform="translateY(95vh)",setTimeout((function(){backdrop.style.zIndex="0"}),500)}),500)}function closeNewLetter(){backdrop.style.opacity="0",setTimeout((function(){document.getElementById("newLetter").style.transform="translateY(95vh)",setTimeout((function(){backdrop.style.zIndex="0"}),500)}),500)}function openReadLetter(){backdrop.style.zIndex="40",document.getElementById("readLetter").style.transform="translateY(0vh)",setTimeout((function(){backdrop.style.opacity="0.5"}),500)}function openNewLetter(){backdrop.style.zIndex="40",document.getElementById("newLetter").style.transform="translateY(0vh)",setTimeout((function(){backdrop.style.opacity="0.5"}),500)}function badLogin(){document.getElementById("name").value="",name.includes("|")?msgStatus.innerHTML="‚ùå Username is unavilable (Please remove all | characters)":msgStatus.innerHTML=""==name||""==name?"‚ùå Please enter a username":"‚ùå Username is taken",currentStatus=400,msgStatus.style.opacity="1",setTimeout((function(){msgStatus.style.opacity="0",currentStatus=0}),3e3)}function submitName(){var e=io.connect(window.location.href);""!=(name=formatName(document.getElementById("name").value))?(e.emit("login",name),e.on("goodlogin",(function(){backdrop.style.opacity="0",setTimeout((function(){document.getElementById("namePrompt").style.opacity="0",setTimeout((function(){backdrop.style.zIndex="0"}),500)}),500),document.getElementById("detector").addEventListener("click",(function(){openNewLetter()})),document.getElementById("send").addEventListener("click",(function(){e.emit("id")})),to.addEventListener("keypress",(function(t){"Enter"==t.code&&e.emit("id")})),document.getElementById("close").addEventListener("click",(function(){closeReadLetter(),open=!1})),document.getElementById("closeNew").addEventListener("click",(function(){closeNewLetter()})),document.getElementById("reply").addEventListener("click",(function(){if(""!=document.getElementById("replyMsg").value){for(var t=void 0,n=0;n<letters.length;n++)letters[n].id==open&&(t=letters[n]);var r={users:t.to.concat(t.from),from:name,id:t.id,reply:document.getElementById("replyMsg").value};document.getElementById("replyMsg").value="",e.emit("reply",JSON.stringify(r))}})),document.getElementById("replyMsg").addEventListener("keypress",(function(t){if("Enter"==t.code&&""!=document.getElementById("replyMsg").value){for(var n=void 0,r=0;r<letters.length;r++)letters[r].id==open&&(n=letters[r]);var s={users:n.to.concat(n.from),from:name,id:n.id,reply:document.getElementById("replyMsg").value};document.getElementById("replyMsg").value="",e.emit("reply",JSON.stringify(s))}})),e.on("id",(function(t){console.log("send msg");var n=to.value.replace(", ",",").split(",");if(console.log(n),console.log(name),n.includes(name)&&n.splice(n.indexOf(name),1),console.log(n),n.length>0&&""!=body.value){for(var r=0;r<n.length;r++)n[r]=formatName(n[r]);t={display:"To: "+to.value.replace(",",", "),from:name,to:n,body:[name+"|"+body.value],read:"",id:t},letters.length>=15&&letters.splice(14,10),letters.unshift(t);for(var s=0;s<letters.length;s++)try{document.getElementById("i"+s.toString()).removeEventListener("click",clicked)}catch(e){}display(),e.emit("send",JSON.stringify(t)),closeNewLetter(),setTimeout((function(){to.value="",ReactDOM.render(React.createElement(TextInput,{placeholder:"To",id:"to"}),document.querySelector("#toContainer")),body.value=""}),600)}else n.length>0?(msgStatus.innerHTML="‚ùå Message is empty",currentStatus=400,msgStatus.style.opacity="1",setTimeout((function(){msgStatus.style.opacity="0",currentStatus=0}),3e3)):(msgStatus.innerHTML="‚ùå Can't send messages to self",currentStatus=404,msgStatus.style.opacity="1",setTimeout((function(){msgStatus.style.opacity="0",currentStatus=0}),3e3))})),e.on("recieve",(function(t){var n=JSON.parse(t),r={name:n.from,id:n.id};try{for(var s=0;s<letters.length;s++)document.getElementById("i"+s.toString()).removeEventListener("click",clicked);n.read=" üîµ",n.display="From: "+unformatName(n.from),letters.length>=15&&letters.splice(14,10),letters.unshift(n),display(),r.status=200}catch(e){r.status=400,console.log(e)}e.emit("msgStatus",JSON.stringify(r))})),e.on("reply",(function(t){var n=JSON.parse(t),r={name:n.from};try{for(var s=0;s<letters.length;s++)if(n.id==letters[s].id){var o=letters[s];if(o.body.push(n.from+"|"+n.reply),open==n.id){o.read="",document.getElementById("i"+s).innerHTML=o.display+o.read;for(var l="",a=0;a<o.body.length;a++){var i=o.body[a].split("|");l=i[0]==name?l+"<div class='text-right text-xs text-gray-600'>"+unformatName(i[0])+"</div><div class='text-right'>"+i[1]+"</div>":l+"<div class='text-left text-xs text-gray-600'>"+unformatName(i[0])+"</div><div class='text-left'>"+i[1]+"</div>"}readBody.innerHTML=l,readBody.scroll({top:readBody.scrollHeight-readBody.clientHeight,left:0,behavior:"smooth"})}else o.read=" üîµ",document.getElementById("i"+s).innerHTML=o.display+o.read;letters[s]=o}r.status=200}catch(e){console.log(e),r.status=400}e.emit("msgStatus",JSON.stringify(r))})),e.on("msgStatus",(function(e){var t=JSON.parse(e);if(console.log(e),400!=currentStatus&&404!=currentStatus){if(200==t.status)msgStatus.innerHTML="‚úÖ Delivered",currentStatus=200;else if(404==t.status){for(var n=0;n<letters.length;n++)letters[n].id==t.id&&1==letters[n].to.length?(letters.splice(n,1),display()):letters[n].id==t.id&&(letters[n].to.splice(letters[n].to.indexOf(t.user)),letters[n].display="To: "+letters[n].to,console.log(letters[n]),display());msgStatus.innerHTML="‚ùå User "+unformatName(t.user)+" not found",currentStatus=404}else msgStatus.innerHTML="‚ùå Unknown Error",currentStatus=400;msgStatus.style.opacity="1",setTimeout((function(){msgStatus.style.opacity="0",currentStatus=0}),3e3)}}))})),e.on("badlogin",badLogin)):badLogin()}lettersObj.addEventListener("scroll",(function(){lettersObj.scrollHeight-lettersObj.clientHeight==lettersObj.scrollTop?document.documentElement.style.setProperty("--scroll-bottom-radius","0px"):0==lettersObj.scrollTop?document.documentElement.style.setProperty("--scroll-top-radius","0px"):(document.documentElement.style.setProperty("--scroll-top-radius","9px"),document.documentElement.style.setProperty("--scroll-bottom-radius","9px"))})),backdrop.style.width=window.innerWidth.toString()+"px",backdrop.style.height=window.innerHeight.toString()+"px",document.getElementById("to"),document.getElementById("submit").addEventListener("click",submitName),document.getElementById("name").addEventListener("keypress",(function(e){"Enter"==e.code&&submitName()}));